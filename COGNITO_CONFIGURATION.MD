# Configuraci√≥n de AWS Cognito para Amplify

## üîß Configuraci√≥n de OAuth Scopes

Este documento explica la configuraci√≥n de OAuth scopes en Amplify y c√≥mo se corrigi√≥ el error `invalid_scope`.

---

## ‚ùå Configuraci√≥n Anterior (con error `invalid_scope`)

La configuraci√≥n anterior inclu√≠a 4 scopes, pero solo 2 estaban habilitados en Cognito:

```dart
"OAuth": {
  "WebDomain": "${CognitoConfig.domain}.auth.${CognitoConfig.region}.amazoncognito.com",
  "AppClientId": CognitoConfig.appClientId,
  "SignInRedirectURI": signInRedirectUri,
  "SignOutRedirectURI": signOutRedirectUri,
  "Scopes": [
    "email",
    "openid",
    "profile",                          // ‚ùå Este scope causaba el error
    "aws.cognito.signin.user.admin"     // ‚ùå Este scope causaba el error
  ]
}
```

### Scopes incluidos (anterior):
- ‚úÖ `email` - Habilitado en Cognito
- ‚úÖ `openid` - Habilitado en Cognito
- ‚ùå `profile` - **NO habilitado en Cognito** (causaba error)
- ‚ùå `aws.cognito.signin.user.admin` - **NO habilitado en Cognito** (causaba error)

---

## ‚úÖ Configuraci√≥n Actual (corregida)

La configuraci√≥n actual solo incluye los scopes que est√°n habilitados en Cognito:

```dart
"OAuth": {
  "WebDomain": "${CognitoConfig.domain}.auth.${CognitoConfig.region}.amazoncognito.com",
  "AppClientId": CognitoConfig.appClientId,
  "SignInRedirectURI": signInRedirectUri,
  "SignOutRedirectURI": signOutRedirectUri,
  "Scopes": [
    "email",
    "openid"                            // ‚úÖ Solo los scopes habilitados en Cognito
  ]
}
```

### Scopes incluidos (actual):
- ‚úÖ `email` - Habilitado en Cognito
- ‚úÖ `openid` - Habilitado en Cognito

---

## üìù Explicaci√≥n del Error

El error `invalid_scope` se deb√≠a a solicitar scopes que **no estaban habilitados** en tu App Client de Cognito.

### ¬øPor qu√© ocurri√≥?

Cuando Amplify intenta autenticar con Cognito, env√≠a una lista de scopes en la petici√≥n OAuth. Si alguno de esos scopes no est√° habilitado en la configuraci√≥n del App Client en AWS Cognito, Cognito rechaza la petici√≥n con el error `invalid_scope`.

### Soluci√≥n

La soluci√≥n fue **remover los scopes no habilitados** (`profile` y `aws.cognito.signin.user.admin`) y mantener solo los que est√°n configurados en Cognito (`email` y `openid`).

---

## üîÑ Si necesitas agregar m√°s scopes

Si en el futuro necesitas usar los scopes `profile` o `aws.cognito.signin.user.admin`, debes:

1. Ir a **AWS Cognito Console**
2. Seleccionar tu **User Pool**: `us-east-1_wC8ztuiNR`
3. Ir a **App integration** ‚Üí **App client settings**
4. Buscar tu **App Client**: `hcfldrsfsmucnanf80oslkbdt`
5. En la secci√≥n **"OpenID Connect scopes"**, habilitar los scopes que necesites:
   - `profile`
   - `aws.cognito.signin.user.admin`
6. Guardar los cambios
7. Actualizar el c√≥digo para incluir esos scopes en el array `"Scopes"`

---

## üìç Ubicaci√≥n del c√≥digo

La configuraci√≥n se encuentra en:
- **Archivo**: `lib/services/services/amplify_config.dart`
- **L√≠neas**: 54-63 (secci√≥n OAuth)

---

## ‚úÖ Estado actual

- ‚úÖ Configuraci√≥n corregida
- ‚úÖ Solo scopes habilitados en Cognito
- ‚úÖ Error `invalid_scope` resuelto
- ‚úÖ Autenticaci√≥n funcionando correctamente
